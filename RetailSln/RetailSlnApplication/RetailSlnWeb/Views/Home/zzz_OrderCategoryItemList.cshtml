@model OrderCategoryItemModel
@using RetailSlnCacheData
@using RetailSlnModels
@{
    ViewBag.Title = "OrderCategoryItemList";
    Layout = "~/Views/Shared/_Layout2.cshtml";
    CategoryLayoutModel categoryLayoutModel = RetailSlnCache.CategoryLayoutModels[0];
    List<CategoryItemHierModel> categoryItemHierModels = categoryLayoutModel.CategoryItemHierModels;
}
<div id="divOrderItem">
</div>
<script type="text/javascript">
    var categoryCount = parseInt("@categoryItemHierModels.Count");
    categoryId_onclick(@Model.ParentCategoryId, 1);
    function window_onload() {
    }
    function categoryId_onclick(categoryId, pageNum) {
        console.log("categoryId_onclick", "00000000", "ENTER!!!", categoryId);
        $("#loadingModal").modal({ backdrop: 'static', keyboard: false });
        document.getElementById("divErrorMessage").innerHTML = "";
        var url = "@Url.Action("OrderCategoryItemListData", "Home")" + "?id=" + categoryId + "&pageNum=" + pageNum;
        $.ajax({
            url: url,
            type: "GET",
            //contentType: "application/json; charset=utf-8",
            //dataType: "json",
            //data: jsonPostDataString,
            success: function (responseData, textStatus, request) {
                $('#loadingModal').modal('hide');
                console.log("00001000", "categoryId_onclick success", responseData.processMessage);
                if (responseData.success) {
                    document.getElementById("selectedCategoryDesc").innerHTML = "";
                    var menuItemObject, menuItemObjectA, menuCategoryIdObject, menuCategoryIdObjectA;
                    for (var i = 1; i < categoryCount; i++) {
                        menuItemObject = document.getElementById("menuItem" + i);
                        menuItemObjectA = document.getElementById("menuItemA" + i);
                        menuCategoryIdObject = document.getElementById("menuCategoryId" + i);
                        menuCategoryIdObjectA = document.getElementById("menuCategoryIdA" + i);
                        if (menuCategoryIdObject.innerHTML == categoryId || menuCategoryIdObjectA.innerHTML == categoryId) {
                            menuItemObject.className = "active";
                            menuItemObjectA.className = "active";
                            document.getElementById("selectedCategoryDesc").innerHTML = menuItemObject.innerHTML;
                        }
                        else {
                            menuItemObject.className = "";
                            menuItemObjectA.className = "";
                        }
                    }
                    document.getElementById("divContainerBody").innerHTML = responseData.htmlString;
                    document.getElementById("divContainerBody").scrollIntoView();
                }
                else {
                    document.getElementById("divErrorMessage").innerHTML = responseData.htmlString;
                }
            },
            error: function (xhr, exception) {
                $('#loadingModal').modal('hide');
                console.log("categoryId_onclick", "00099000", "ERROR???");
                document.getElementById("divErrorMessage").innerHTML = "Error occurred";
                console.log(xhr, exception);
            }
        });
    }
    function addToCart_onclick(categoryId, pageNum, pageSize, totalRowCount) {
        console.log("addToCart_onclick", "00000000", "ENTER!!!");
        $("#loadingModal").modal({ backdrop: 'static', keyboard: false });
        document.getElementById("divErrorMessage").innerHTML = "";
        var jsonPostData = {};
        var shoppingCartItemModels = [];
        var shoppingCartItemModel, orderQtyHtmlElement, itemId, orderQty, orderComments;
        for (var i = 0; ; i++) {
            orderQtyHtmlElement = document.getElementById("orderQty" + i);
            if (orderQtyHtmlElement == null) {
                break;
            }
            else {
                orderQty = document.getElementById("orderQty" + i).value;
                if ((/^\d+$/.test(orderQty)) && orderQty.length <= document.getElementById("orderQty" + i).getAttribute("maxlength") && orderQty >= document.getElementById("orderQty" + i).getAttribute("min") && orderQty <= document.getElementById("orderQty" + i).getAttribute("max")) {
                    itemId = document.getElementById("itemId" + i).innerText;
                    orderComments = "";//document.getElementById("orderComments" + i).value;
                    shoppingCartItemModel = {};
                    shoppingCartItemModel.ItemId = itemId;
                    shoppingCartItemModel.OrderQty = orderQty;
                    shoppingCartItemModel.OrderComments = orderComments;
                    shoppingCartItemModels.push(shoppingCartItemModel);
                }
            }
        }
        if (shoppingCartItemModels.length === 0) {
            $('#loadingModal').modal('hide');
            document.getElementById("divErrorMessage").innerHTML = "Please enter order quantity for a min of 1 item";
            alert(document.getElementById("divErrorMessage").innerHTML);
        }
        else {
            var jsonPostDataString;
            jsonPostData.CategoryId = categoryId;
            jsonPostData.PageNum = pageNum;
            jsonPostData.PageSize = pageSize;
            jsonPostData.TotalRowCount = totalRowCount;
            jsonPostData.ViewName = "_OrderCategoryItemList";
            jsonPostData.ShoppingCartItemModels = shoppingCartItemModels;
            jsonPostDataString = JSON.stringify(jsonPostData);
            console.log(-999, jsonPostDataString);
            var url = "/Home/AddToCart/";
            $.ajax({
                url: url,
                type: "POST",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: jsonPostDataString,
                success: function (responseData, textStatus, request) {
                    $('#loadingModal').modal('hide');
                    console.log("00001000", "addToCart_onclick success", responseData.processMessage);
                    if (responseData.success) {
                        document.getElementById("divOrderItem").innerHTML = responseData.htmlString;
                        document.getElementById("shoppingCartItemsCount").innerHTML = responseData.shoppingCartItemsCount;
                        document.getElementById("shoppingCartTotalAmount").innerHTML = responseData.shoppingCartTotalAmount;
                    }
                    else {
                        document.getElementById("divErrorMessage").innerHTML = responseData.htmlString;
                    }
                },
                error: function (xhr, exception) {
                    $('#loadingModal').modal('hide');
                    console.log("addToCart_onclick", "00099000", "ERROR???");
                    console.log(xhr, exception);
                }
            });
        }
    }
    function orderComments_onchange(index) {
        console.log("orderComments_onchange", "00000000", "ENTER!!!");
        $("#loadingModal").modal({ backdrop: 'static', keyboard: false });
        document.getElementById("divErrorMessage").innerHTML = "";
        try {
            var orderComments = document.getElementById("orderComments" + index).value;
            if (orderComments === null || orderComments === "") {
                $('#loadingModal').modal('hide');
                return;
            }
            var url = "/Home/ShoppingCartComments";
            $.ajax({
                url: url,
                type: "GET",
                //contentType: "application/x-www-form-urlencoded; charset=UTF-8",//"application/x-www-form-urlencoded; charset=UTF-8",//"text/plain; charset=UTF-8", //false, //"application/json; charset=utf-8",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: { "index": index, "orderComments": orderComments },
                async: true,
                success: function (responseData, textStatus, request) {
                    $('#loadingModal').modal('hide');
                    console.log("orderComments_onchange", "00090000", "SUCCESS!!!", responseData.success);
                },
                error: function (xhr, exception) {
                    $('#loadingModal').modal('hide');
                    console.log("orderComments_onchange", "00099000", "ERROR???");
                    console.log(exception, xhr);
                    var jsonData = JSON.parse(xhr.responseText);
                    document.getElementById("divErrorMessage").innerHTML = jsonData.errorMessage;
                }
            });
        }
        catch (err) {
            alert("Please fix errors to continue???");
        }
        return false;
    }
    function orderQty_oninput(index) {
        if (document.getElementById("orderQty" + index).value.length > document.getElementById("orderQty" + index).getAttribute("maxlength")) {
            document.getElementById("orderQty" + index).value = document.getElementById("orderQty" + index).value.substr(0, document.getElementById("orderQty" + index).getAttribute("maxlength"));
        }
    }
    function removeFromCart_onclick(index) {
        console.log("removeFromCart_onclick", "00000000", "ENTER!!!");
        $("#loadingModal").modal({ backdrop: 'static', keyboard: false });
        document.getElementById("divErrorMessage").innerHTML = "";
        var jsonPostData =
        {
            ParentCategoryId: document.getElementById("ParentCategoryId").value,
            PageNum: document.getElementById("PageNum").value,
            PageSize: document.getElementById("PageSize").value,
            TotalRowCount: document.getElementById("TotalRowCount").value,
            RemoveFromCartIndex: index,
        };
        var jsonPostDataString = JSON.stringify(jsonPostData);
        try {
            var url = "/Home/RemoveFromCart/";
            $.ajax({
                url: url,
                type: "POST",
                contentType: "application/json; charset=utf-8",
                //contentType: "application/x-www-form-urlencoded; charset=UTF-8",//"application/x-www-form-urlencoded; charset=UTF-8",//"text/plain; charset=UTF-8", //false, //"application/json; charset=utf-8",
                dataType: "json",
                data: jsonPostDataString,
                async: true,
                success: function (responseData, textStatus, request) {
                    $('#loadingModal').modal('hide');
                    console.log("removeFromCart_onclick", "00090000", "SUCCESS!!!");
                    if (responseData.success) {
                        document.getElementById("divOrderItem").innerHTML = responseData.htmlString;
                        document.getElementById("shoppingCartItemsCount").innerHTML = responseData.shoppingCartItemsCount;
                        document.getElementById("shoppingCartTotalAmount").innerHTML = responseData.shoppingCartTotalAmount;
                    }
                    else {
                        document.getElementById("divErrorMessage").innerHTML = responseData.htmlString;
                    }
                },
                error: function (xhr, exception) {
                    $('#loadingModal').modal('hide');
                    console.log("removeFromCart_onclick", "00099000", "ERROR???");
                    console.log(exception, xhr);
                    var jsonData = JSON.parse(xhr.responseText);
                    document.getElementById("divErrorMessage").innerHTML = jsonData.errorMessage;
                }
            });
        }
        catch (err) {
            alert("Please fix errors to continue???");
        }
        return false;
    }
    function checkoutValidate_onclick() {
        console.log("00000000", "checkoutValidate_onclick", "Enter");
        $("#loadingModal").modal({ backdrop: 'static', keyboard: false });
        document.getElementById("divErrorMessage").innerHTML = "";
        var url = "/Home/CheckoutValidate";
        $.ajax({
            url: url,
            type: "POST",
            //contentType: "application/x-www-form-urlencoded; charset=UTF-8",//"application/x-www-form-urlencoded; charset=UTF-8",//"text/plain; charset=UTF-8", //false, //"application/json; charset=utf-8",
            dataType: "json",
            async: true,
            success: function (responseData, textStatus, request) {
                console.log(responseData);
                $('#loadingModal').modal('hide');
                console.log("00001000", "checkoutValidate_onclick success", responseData.processMessage);
                if (responseData.success) {
                    window.location.href = "/Checkout/";
                }
                else {
                    document.getElementById("divErrorMessage").innerHTML = responseData.htmlString;
                    document.getElementById("shoppingCartItemsCount").innerHTML = responseData.shoppingCartItemsCount;
                    document.getElementById("shoppingCartTotalAmount").innerHTML = responseData.shoppingCartTotalAmount;
                    alert(responseData.htmlString);
                }
                console.log("00090000", "checkoutValidate_onclick success", "Exit");
            },
            error: function (xhr, exception) {
                $('#loadingModal').modal('hide');
                console.log("checkoutValidate_onclick", "00099000", "ERROR???");
                document.getElementById("divErrorMessage").innerHTML = "Error during checkout";
                document.getElementById("shoppingCartItemsCount").innerHTML = "";
                document.getElementById("shoppingCartTotalAmount").innerHTML = "0.00";
                alert("Error during checkout");
            }
        });
        return false;
    }
</script>
