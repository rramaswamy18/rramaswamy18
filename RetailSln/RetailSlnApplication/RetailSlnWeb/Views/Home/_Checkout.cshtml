@model RetailSlnModels.CheckoutModel
@{
    Model.ShoppingCartModel.Checkout = false;
    Model.ShoppingCartModel.ShowDiscountsAdditionalCharges = false;
}
<form id="formRazorPayReturn" action="/Home/RazorPayReturn" method="post" asp-antiforgery="true">
    <input type="hidden" id="razorpay_payment_id" name="razorpay_payment_id" />
    <input type="hidden" id="razorpay_order_id" name="razorpay_order_id" />
    <input type="hidden" id="razorpay_signature" name="razorpay_signature" />
    <button type="submit" id="rzp-paymentresponse" class="btn btn-primary" style="display: none;">Submit</button>
</form>
<div class="center" id="divOrderProcess">
    <h2 class="text-center mb-4" style="color: #a54000; font-weight: bold; letter-spacing: 4px; text-transform: uppercase;">
        Checkout
    </h2>
    <div class="col-md-6" style="float: left; padding-right: 18px; text-align: left;">
        <h3 style="font-weight: bold;">L O G I N <span style="color: #ff0000;">(Returning users)</span></h3>
        @if (!ViewData.ModelState.IsValid)
        {
            <div id="divLoginUserProfScrollIntoView" style="font-weight: bold;"></div>
            @Html.Raw(HttpUtility.HtmlDecode(Html.ValidationSummary(false, "", new { @class = "validationSummaryErrors" }).ToHtmlString()))
        }
        else
        {
            <ul style="font-weight: bold;">
                <li>
                    Please enter email address, login password, captcha answer
                </li>
                <li>
                    Click <span style="color: #0000ff; font-size: 18px;">L O G I N</span> to continue
                </li>
                <li style="color: #ff0000;">
                    Did you forget your password - feel free to reset
                </li>
                <li>
                    Passwords have expiry date. Feel free to reset
                </li>
            </ul>
            <form id="formLoginUserProfData">
                @Html.Partial("_LoginUserProfData", Model.LoginUserProfModel)
            </form>
            <button class="loginRegisterbtn" id="checkoutLoginUser" onclick="javascript: return checkoutLoginUser_onclick();" style="width: 90%;" type="button">L O G I N</button>
            <br style="clear: both;" />
            <br style="clear: both;" />
            <ul style="font-size: 14px; font-weight: bold;">
                <li>
                    <a href="@Url.Action("ResetPasswordContactUs", "Home")" style="color: #ff0000; font-size: 14px; text-decoration: underline;" target="_blank">Click here to reset your password</a>
                </li>
                <li>
                    <a href="@Url.Action("ContactUs", "Home")" style="color: #0000ff; font-size: 14px; text-decoration: underline;" target="_blank">Click here to Contact Us...</a>
                </li>
            </ul>
            <ul style="font-size: 14px; font-weight: bold;">
                <li>
                    Login and enjoy the rich features of the product
                </li>
            </ul>
        }
        <hr style="background-color: #000000; display: block; font-size: 18px; font-weight: bold; height: 1px;" />
        <div id="divShoppingCart">
            @Html.Partial("_ShoppingCart", Model.ShoppingCartModel)
        </div>
    </div>
    <div class="col-md-6" style="float: left; padding-left: 18px; text-align: left;">
        @*@Html.Partial("_LoginUserProfGuest", Model.CheckoutGuestModel)*@
        @Html.Partial("_RegisterUserProf", Model.RegisterUserProfModel)
    </div>
</div>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script type="text/javascript">
    var searchResults;
    function checkoutGuestUser_onclick() {
        console.log("00000000", "loginUserProfGuestSave_onclick", "ENTER!!!");
        $("#loadingModal").modal({ backdrop: 'static', keyboard: false });
        var url = "/Home/CheckoutGuest";
        var postData = $("#formLoginUserProfGuestData").serialize();
        $.ajax({
            url: url,
            type: "POST",
            contentType: "application/x-www-form-urlencoded; charset=UTF-8",//"application/x-www-form-urlencoded; charset=UTF-8",//"text/plain; charset=UTF-8", //false, //"application/json; charset=utf-8",
            //dataType: "html",
            data: postData,
            //async: false,
            success: function (responseData, textStatus, request) {
                $("#loadingModal").modal('hide');
                if (responseData.success) {
                    document.getElementById("divOrderProcess").innerHTML = responseData.htmlString;
                    document.getElementById("loggedInUserFullName").innerHTML = responseData.loggedInUserFullName;
                    document.getElementById("loggedInUserEmailAddress").innerHTML = responseData.loggedInUserEmailAddress;
                }
                else {
                    document.getElementById("formLoginUserProfGuestData").innerHTML = responseData.htmlString;
                }
                console.log("00001000", "loginUserProfGuestSave_onclick success", responseData.processMessage);
            },
            error: function (xhr, exception) {
                $("#loadingModal").modal('hide');
                document.getElementById("formLoginUserProfGuestData").innerHTML = xhr.responseText;
                console.log("00099000", "loginUserProfGuestSave_onclick", "ERROR???", exception, xhr);
            }
        });
    }
    function checkoutLoginUser_onclick() {
        console.log("00000000", "checkoutLoginUser_onclick", "ENTER!!!");
        $("#loadingModal").modal({ backdrop: 'static', keyboard: false });
        var url = "/Home/Checkout";
        var postData = $("#formLoginUserProfData").serialize();
        $.ajax({
            url: url,
            type: "POST",
            contentType: "application/x-www-form-urlencoded; charset=UTF-8",//"application/x-www-form-urlencoded; charset=UTF-8",//"text/plain; charset=UTF-8", //false, //"application/json; charset=utf-8",
            //dataType: "html",
            data: postData,
            //async: false,
            success: function (responseData, textStatus, request) {
                $("#loadingModal").modal('hide');
                if (responseData.success) {
                    document.getElementById("divOrderProcess").innerHTML = responseData.htmlString;
                }
                else {
                    document.getElementById("formLoginUserProfData").innerHTML = responseData.htmlString;
                }
                console.log("00001000", "checkoutLoginUser_onclick success", responseData.processMessage);
            },
            error: function (xhr, exception) {
                $("#loadingModal").modal('hide');
                document.getElementById("formLoginUserProfData").innerHTML = xhr.responseText;
                console.log("00099000", "checkoutLoginUser_onclick", "ERROR???", exception, xhr);
            }
        });
    }
    function deliveryInfoSave_onclick() {
        console.log("00000000", "deliveryInfoSave_onclick");
        $("#loadingModal").modal({ backdrop: 'static', keyboard: false });
        var url = "/Home/DeliveryInfo";
        var postData = $("#formDeliveryInfoData").serialize();
        $.ajax({
            url: url,
            type: "POST",
            contentType: "application/x-www-form-urlencoded; charset=UTF-8",//"application/x-www-form-urlencoded; charset=UTF-8",//"text/plain; charset=UTF-8", //false, //"application/json; charset=utf-8",
            //dataType: "html",
            data: postData,
            //async: false,
            success: function (responseData, textStatus, request) {
                $("#loadingModal").modal('hide');
                if (responseData.success) {
                    document.getElementById("divOrderProcess").innerHTML = responseData.htmlString;
                }
                else {
                    document.getElementById("formDeliveryInfoData").innerHTML = responseData.htmlString;
                }
                document.getElementById("formPaymentData").scrollIntoView();
                console.log("00001000", "deliveryInfoSave_onclick success", responseData.processMessage);
            },
            error: function (xhr, exception) {
                $("#loadingModal").modal('hide');
                document.getElementById("formDeliveryInfoData").innerHTML = xhr.responseText;
                console.log("00099000", "deliveryInfoSave_onclick error", exception, xhr);
            }
        });
    }
    function giftCertBalance_onclick() {
        console.log("00000000", "giftCertBalance_onclick", "ENTER!!!");
        $("#loadingModal").modal({ backdrop: 'static', keyboard: false });
        var url = "/Home/GiftCertBalance?";
        var jsonData, jsonDataString;
        //var queryString = "giftCertNumber=" + document.getElementById("GiftCertNumber").value + "&giftCertKey=" + document.getElementById("GiftCertKey").value;
        jsonData = {};
        jsonData.GiftCertNumber = document.getElementById("GiftCertNumber").value;
        jsonData.GiftCertKey = document.getElementById("GiftCertKey").value;
        jsonDataString = JSON.stringify(jsonData);
        $.ajax({
            url: url,//+ queryString,
            type: "POST",
            contentType: "application/json; charset=utf-8",//"application/x-www-form-urlencoded; charset=UTF-8",//"application/x-www-form-urlencoded; charset=UTF-8",//"text/plain; charset=UTF-8", //false, //"application/json; charset=utf-8",
            dataType: "json",
            data: jsonDataString,
            //async: false,
            success: function (responseData, textStatus, request) {
                $("#loadingModal").modal('hide');
                if (responseData.success) {
                    document.getElementById("giftCertBalanceAmount").innerHTML = responseData.giftCertBalanceAmount;
                }
                else {
                    document.getElementById("giftCertBalanceAmount").innerHTML = responseData.errorMessage;
                }
                console.log("00090000", "giftCertBalance_onclick", "SUCCESS!!!");
            },
            error: function (xhr, exception) {
                $("#loadingModal").modal('hide');
                document.getElementById("giftCertBalanceAmount").innerHTML = xhr.responseText.errorMessage;
                console.log("00099000", "giftCertBalance_onclick", "ERROR???", exception, xhr);
            }
        });
        return false;
    }
    function paymentSave_onclick() {
        console.log("00000000", "paymentSave_onclick");
        $("#loadingModal").modal({ backdrop: 'static', keyboard: false });
        var url = "/Home/Payment";
        var postData = $("#formPaymentData").serialize();
        $.ajax({
            url: url,
            type: "POST",
            contentType: "application/x-www-form-urlencoded; charset=UTF-8",//"application/x-www-form-urlencoded; charset=UTF-8",//"text/plain; charset=UTF-8", //false, //"application/json; charset=utf-8",
            //dataType: "html",
            data: postData,
            //async: false,
            success: function (responseData, textStatus, request) {
                debugger;
                console.log("00000100", "paymentSave_onclick");
                console.log(9, responseData);
                $("#loadingModal").modal('hide');
                if (responseData.success) {
                    console.log("00000200", "paymentSave_onclick");
                    if (responseData.creditCardProcessor == "RAZORPAYTEST") {
                        console.log("00000300", "paymentSave_onclick");
                        var jsonObject = JSON.parse(responseData.htmlString);
                        console.log(9.9, responseData.htmlString, jsonObject);
                        var options = {
                            "key": jsonObject.RazorpayKey,
                            "amount": jsonObject.Amount,
                            "currency": jsonObject.Currency,
                            "name": jsonObject.Name,
                            "description": jsonObject.Description,
                            "image": "https://avatars.githubusercontent.com/u/65504583?v=4",
                            "order_id": jsonObject.OrderId,
                            "handler": function (response) {
                                console.log(9.18, response);
                                //document.getElementById(("formRazorPayReturn").action = "/Home/RazorPayReturn";
                                document.getElementById('razorpay_payment_id').value = response.razorpay_payment_id;
                                document.getElementById('razorpay_order_id').value = response.razorpay_order_id;
                                document.getElementById('razorpay_signature').value = response.razorpay_signature;
                                document.getElementById('rzp-paymentresponse').style.display = "block";
                                document.getElementById('rzp-paymentresponse').click();
                            },
                            "prefill": {
                                "name": jsonObject.Name,
                                "email": jsonObject.Email,
                                "contact": jsonObject.PhoneNumber
                            },
                            "notes": {
                                "address": jsonObject.Address
                            },
                            "theme": {
                                "color": "#f37254"
                            }
                        };
                        var rzp1 = new Razorpay(options);
                        rzp1.open();
                    }
                    else {
                        document.getElementById("divOrderProcess").innerHTML = responseData.htmlString;
                        document.getElementById("loggedInUserFullName").innerHTML = responseData.loggedInUserFullName;
                        document.getElementById("loggedInUserEmailAddress").innerHTML = responseData.loggedInUserEmailAddress;
                        document.getElementById("shoppingCartItemsCount").innerHTML = "";
                        document.getElementById("shoppingCartTotalAmount").innerHTML = "";
                        document.getElementById("shoppingCartItemsCount2").innerHTML = "";
                        document.getElementById("shoppingCartTotalAmount2").innerHTML = "";
                    }
                    //document.getElementById("divOrderProcess").scrollIntoView();
                }
                else {
                    document.getElementById("formPaymentData").innerHTML = responseData.htmlString;
                }
                console.log("00001000", "paymentSave_onclick success", responseData.processMessage);
                $("#loadingModal").modal('hide');
            },
            error: function (xhr, exception) {
                $("#loadingModal").modal('hide');
                document.getElementById("formPaymentData").innerHTML = xhr.responseText;
                console.log("00099000", "paymentSave_onclick error", exception, xhr);
                $("#loadingModal").modal('hide');
            }
        });
    }
    function removeFromCart_onclick(index) {
        console.log("removeFromCart_onclick", "00000000", "ENTER!!!");
        $("#loadingModal").modal({ backdrop: 'static', keyboard: false });
        document.getElementById("divErrorMessage").innerHTML = "";
        try {
            var url = "/Home/RemoveFromCart2/" + index;
            $.ajax({
                url: url,
                type: "GET",
                //contentType: "application/x-www-form-urlencoded; charset=UTF-8",//"application/x-www-form-urlencoded; charset=UTF-8",//"text/plain; charset=UTF-8", //false, //"application/json; charset=utf-8",
                dataType: "json",
                async: true,
                success: function (responseData, textStatus, request) {
                    $('#loadingModal').modal('hide');
                    if (responseData.success) {
                        document.getElementById("divShoppingCart").innerHTML = responseData.htmlString;
                        document.getElementById("shoppingCartItemsCount").innerHTML = responseData.shoppingCartItemsCount;
                        document.getElementById("shoppingCartTotalAmount").innerHTML = responseData.shoppingCartTotalAmount;
                    }
                    else {
                        document.getElementById("divErrorMessage").innerHTML = responseData.htmlString;
                    }
                },
                error: function (xhr, exception) {
                    $('#loadingModal').modal('hide');
                    var jsonData = JSON.parse(xhr.responseText);
                    document.getElementById("divErrorMessage").innerHTML = jsonData.errorMessage;
                }
            });
        }
        catch (err) {
            alert("Please fix errors to continue???");
        }
        return false;
    }
    function orderComments_onchange(index) {
        console.log("orderComments_onchange", "00000000", "ENTER!!!");
        $("#loadingModal").modal({ backdrop: 'static', keyboard: false });
        document.getElementById("divErrorMessage").innerHTML = "";
        try {
            var orderComments = document.getElementById("orderComments" + index).value;
            if (orderComments === null || orderComments === "") {
                $('#loadingModal').modal('hide');
                return;
            }
            var url = "/Home/ShoppingCartComments";
            $.ajax({
                url: url,
                type: "GET",
                //contentType: "application/x-www-form-urlencoded; charset=UTF-8",//"application/x-www-form-urlencoded; charset=UTF-8",//"text/plain; charset=UTF-8", //false, //"application/json; charset=utf-8",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: { "index": index, "orderComments": orderComments },
                async: true,
                success: function (responseData, textStatus, request) {
                    $('#loadingModal').modal('hide');
                },
                error: function (xhr, exception) {
                    $('#loadingModal').modal('hide');
                    var jsonData = JSON.parse(xhr.responseText);
                    document.getElementById("divErrorMessage").innerHTML = jsonData.errorMessage;
                }
            });
        }
        catch (err) {
            alert("Please fix errors to continue???");
        }
        return false;
    }
</script>
<script src="~/Include/searchDataCode.js" type="text/javascript"></script>
