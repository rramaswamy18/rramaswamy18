@model OrderCategoryItemModel
@using ArchitectureLibraryCacheData
@using RetailSlnCacheData
@using RetailSlnModels
@{
    long clientId = ArchLibCache.ClientId;
    string clientName = ArchLibCache.ClientName;
    CategoryLayoutModel categoryLayoutModel = RetailSlnCache.CategoryLayoutModels[Model.ParentCategoryId];
    List<CategoryItemHierModel> categoryItemHierModels = categoryLayoutModel.CategoryItemHierModels;//.Skip(startIndex).Take(pageSize).ToList();
    var shoppingCartModel = ((ShoppingCartModel)Session["ShoppingCartModel"]) ?? new ShoppingCartModel();
    var shoppingCartItems = shoppingCartModel?.ShoppingCartItems;
    ShoppingCartItemModel shoppingCartItemModel;
    if (shoppingCartModel != null)
    {
        shoppingCartModel.Checkout = true;
    }
    int shoppingCartItemIndex;
    string orderQty;
    ItemModel itemModel;
    @BuildPaginationLinks(9);
    <div class="center" style="width: 100%;">
        <table id="tableOrderItemListData" class="table table-responsive" style="margin-left: auto; margin-right: auto; width: 81%;">
            <colgroup>
                <col style="width: 3%" />
                <col style="width: 32%" />
                <col style="width: 8%" />
                <col style="width: 9%" />
                <col style="width: 27%" />
                <col />
                <col />
            </colgroup>
            <tr>
                <th>
                    #
                </th>
                <th>
                    Description
                </th>
                <th class="text-right">
                    Rate
                </th>
                <th class="text-center">
                    Order<br />Qty
                </th>
                <th>
                    Comments<br />Optional
                </th>
                <th>
                    Add
                </th>
                <th>
                    Remove
                </th>
            </tr>
            @{
                int i, index = -1;
                for (i = 0; i < categoryItemHierModels.Count; i++)
                {
                    index++;
                    itemModel = categoryItemHierModels[i].ItemModel;
                    shoppingCartItemModel = null;
                    shoppingCartItemIndex = -1;
                    if (shoppingCartItems != null)
                    {
                        shoppingCartItemModel = shoppingCartItems.FirstOrDefault(x => x.ItemId == itemModel.ItemId);
                        shoppingCartItemIndex = shoppingCartItems.FindIndex(x => x.ItemId == itemModel.ItemId);
                    }
                    orderQty = shoppingCartItemModel == null ? "" : shoppingCartItemModel.OrderQty.Value.ToString();
                    <tr>
                        <td class="text-right" style="font-family: Arial; font-size: 12px; vertical-align: middle;">
                            @(index + 1).
                        </td>
                        <td class="text-left" style="font-family: Arial; font-size: 12px; vertical-align: middle;">
                            @itemModel.ItemShortDesc
                            @if (shoppingCartItemModel == null)
                            {
                            }
                            else
                            {
                                <br />
                                <i class='fa fa-check' style="color: #00d000; padding-left: 7px; padding-right: 1px;"></i>
                                <span style="color: #a54000; font-weight: bold;">Order Qty :</span><span style="color: #0000ff; font-weight: bold;">&nbsp;@shoppingCartItemModel.OrderQty</span>
                            }
                            <span id="itemId@(index)" style="display: none;">@itemModel.ItemId</span>
                        </td>
                        <td class="text-right" style="font-family: Arial; font-size: 12px; vertical-align: middle;">
                            @itemModel.ItemRateFormatted
                        </td>
                        <td class="text-left" style="vertical-align: middle;">
                            <input class="form-control" id="orderQty@(index)" inputmode="numeric" max="9999" maxlength="4" min="1" oninput="javascript: return orderQty_oninput(@index);" style="background-color: #e1e1e1; border-color: #000000; border-style: none; border-width: 1px; border-radius: 30px; float: left; font-size: 12px; font-weight: 900; padding-right: 9px; width: 81px;" title="Enter quantity and click add to cart @itemModel.ItemShortDesc" type="number" value="@orderQty" />
                        </td>
                        <td class="text-left" style="vertical-align: middle;">
                            <input class="form-control" id="orderComments@(index)" maxlength="1024" , onchange="javascript: return orderComments_onchange(@index);" ); placeholder="Comments" style="font-size: 12px; width: 90%;" type="text" value="@(shoppingCartItemModel?.OrderComments)" />
                        </td>
                        <td class="text-left" style="vertical-align: middle;">
                            <a href="javascript: void(0);" onclick="javascript: return addToCart_onclick(@index);" title="Enter quantity and click add to cart @itemModel.ItemShortDesc"><img alt="Enter quantity and click add to cart" src="~/Images/Addtocart.png" style="height: 40px; width: 40px;" title="Enter quantity and click add to cart @itemModel.ItemShortDesc" /></a>
                        </td>
                        <td class="text-center" style="vertical-align: middle;">
                            @if (shoppingCartItemIndex > -1)
                            {
                                <a href="javascript: void(0);" onclick="javascript: return removeFromCart_onclick(@shoppingCartItemIndex);"><img alt="" src="~/Images/Delete.jpg" title="Click to remove the item from shopping cart at index #@(shoppingCartItemIndex)" /></a>
                            }
                        </td>
                        <td class="text-center" style="vertical-align: middle;">
                            <img alt="@itemModel.ImageTitle" src="~/ClientSpecific/@(clientId)_@(clientName)/Documents/Images/Items/@itemModel.ImageName" style="height: 90px; width: 90px;" title="@itemModel.ImageTitle" />
                        </td>
                    </tr>
                }
            }
        </table>
    </div>
    @BuildPaginationLinks(9);
}
@helper BuildPaginationLinks(int pageCount)
{
    <ul class="pagination">
        @if (Model.PageNum == 1)
        {
            <li class="page-item">
                <span class="page-link">Prev</span>
            </li>
        }
        else
        {
            <li class="page-item">
                <a alt="Page# @(Model.PageNum - 1)" class="page-link" href="javascript: void(0);" onclick="javascript: return categoryId_onclick(@Model.ParentCategoryId, @(Model.PageNum - 1));" , title="Jump to page# @(Model.PageNum - 1)">
                    Prev
                </a>
            </li>
        }
        @for (int i = 1; i <= pageCount; i++)
        {
            if (i == Model.PageNum)
            {
                <li class="page-item active">
                    <a alt="Page# @i" class="page-link" href="javascript: void(0);" onclick="javascript: return categoryId_onclick(@Model.ParentCategoryId, @i);" , title="Jump to page# @i">
                        @i
                    </a>
                </li>
            }
            else
            {
                <li class="page-item">
                    <a alt="Page# @i" class="page-link" href="javascript: void(0);" onclick="javascript: return categoryId_onclick(@Model.ParentCategoryId, @i);" , title="Jump to page# @i">
                        @i
                    </a>
                </li>
            }
        }
        @if (Model.PageNum == pageCount)
        {
            <li class="page-item">
                <span class="page-link">Next</span>
            </li>
            @*<li class="page-item">
                    <span class="page-link">Last</span>
                </li>*@
        }
        else
        {
            <li class="page-item">
                <a alt="Page# @(Model.PageNum - 1)" class="page-link" href="javascript: void(0);" onclick="javascript: return categoryId_onclick(@Model.ParentCategoryId, @(Model.PageNum + 1));" , title="Jump to page# @(Model.PageNum + 1)">
                    Next
                </a>
            </li>
            @*<li class="page-item">
                    <a alt="Page# @pageCount" class="page-link" href="@Url.Action("OrderCategoryItem", "Home", new { id = Model.ParentCategoryId, pageNum = pageCount })" , title="Jump to page# @pageCount">Last</a>
                </li>*@
        }
    </ul>
}
